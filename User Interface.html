<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Game</title>
</head>
<body>
    <label for="getName">Enter name name/nickname
    <input   type = "text" id = "getName">
    <button type="submit" onclick="getname()">Start</button>
    <p id = "error"></p>
</label>
<script>
    function getname() {
        var validname = document.getElementById("getName").value;
        fetch("https://codecyprus.org/th/api/list?include-active")
            .then(response => response.json()) //Parse JSON text to JavaScript object
            .then(jsonObject => {
                console.log(jsonObject); //TODO - Success, do something with the data.
                let list = document.getElementById("challenges");

                let array = jsonObject.treasureHunts;
                let uuid = array[0].uuid;



                var xmlhttp = new XMLHttpRequest();
                xmlhttp.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 200) {
                        var myObj = JSON.parse(this.responseText);
                        console.log(this.responseText);
                        if(myObj.status === "ERROR") {
                            document.getElementById("error").innerHTML = myObj.errorMessages;
                        }else{
                            let session =  myObj.session;
                            alert(session);
                        }
                    }
                };
                xmlhttp.open("GET", "https://codecyprus.org/th/api/start?player=" + validname + "&app=Sample-treasure-hunt&treasure-hunt-id=" + uuid + "", true);
                xmlhttp.send();

                    fetch("https://codecyprus.org/th/api/question?session="+sessionid+"")
                        .then(response => response.json()) //Parse JSON text to JavaScript object
                        .then(jsonObject => {
                            console.log(jsonObject); //TODO - Success, do something with the data.
                            let list = document.getElementById("error");


                        });
                });


    }

</script>
</body>
</html>