<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Game</title>
</head>
<body>
<label for="getName">Enter name name/nickname
    <input   type = "text" id = "getName">
    <button type="submit" onclick="username()">Start</button>
</label>
<p id = "error"></p>
<script>
    function username() {
        var validName = document.getElementById("getName").value;
        getname(validName)

    }

    function getname(validname) {
        fetch("https://codecyprus.org/th/api/list?include-active")
            .then(response => response.json()) //Parse JSON text to JavaScript object
            .then(jsonObject => {
                console.log(jsonObject); //TODO - Success, do something with the data.
                let array = jsonObject.treasureHunts;
                let uuid = array[0].uuid;
                start(uuid, validname)
            });
    }
    function start(uuid, name) {
        fetch("https://codecyprus.org/th/api/start?player=" + name + "&app=Sample-treasure-hunt&treasure-hunt-id=" + uuid + "")
            .then(response => response.json()) //Parse JSON text to JavaScript object
            .then(jsonObject => {
                console.log(jsonObject); //TODO - Success, do something with the data.//
                var myObj = jsonObject;
                if (myObj.status === "ERROR") {
                    document.getElementById("error").innerHTML = myObj.errorMessages;
                } else {
                    let sessionId = myObj.session;
                    question(sessionId)
                }
            });
    }
    function question(sessionID) {
        fetch("https://codecyprus.org/th/api/question?session=" + sessionID + "")
            .then(response => response.json()) //Parse JSON text to JavaScript object
            .then(jsonObject => {
                console.log(jsonObject); //TODO - Success, do something with the data.//

            });
    }
</script>
</body>
</html>