<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Game</title>
</head>
<body>
    <label for="getName">Enter name name/nickname
    <input   type = "text" id = "getName">
    <button type="submit" onclick="username()">Start</button>
</label>
    <p id = "error"></p>
<script>
    function username() {
        var validName = document.getElementById("getName").value;
        getname(validName)

    }

    function getname(validname) {
        fetch("https://codecyprus.org/th/api/list?include-active")
            .then(response => response.json()) //Parse JSON text to JavaScript object
            .then(jsonObject => {
                console.log(jsonObject); //TODO - Success, do something with the data.
                let array = jsonObject.treasureHunts;
                let uuid = array[0].uuid;
                start(uuid, validname)
            });
    }
    function start(uuid, name) {
        var start = new XMLHttpRequest();
        start.onreadystatechange = function session() {
            var myObj = JSON.parse(this.responseText);
            console.log(this.responseText);

            if (myObj.status === "ERROR") {
                document.getElementById("error").innerHTML = myObj.errorMessages;
            } else {
                let sessionId = myObj.session;
               question(sessionId)
            }
        };
        start.open("GET", "https://codecyprus.org/th/api/start?player=" + name + "&app=Sample-treasure-hunt&treasure-hunt-id=" + uuid + "", true);
        start.send();
    }
    function question(sessionID) {
        var xmlhttp = new XMLHttpRequest();
        xmlhttp.onreadystatechange = function () {
            var myObjects = JSON.parse(this.responseText);
            console.log(this.responseText);
        };
        xmlhttp.open("GET", "https://codecyprus.org/th/api/question?session=" + sessionID + "", true);
        xmlhttp.send();
    }
</script>
</body>
</html>